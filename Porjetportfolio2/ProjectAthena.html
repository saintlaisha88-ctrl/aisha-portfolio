<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Projet Ath√©na - Le Jeu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #e6f7ff;
      color: #333;
      text-align: center;
      padding: 20px;
      position: relative;
    }
    h1 {
      color: #005f99;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .game-section {
      margin: 20px auto;
      padding: 25px;
      background-color: #ffffff;
      border-radius: 15px;
      max-width: 750px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      text-align: left;
      transition: all 0.5s ease-in-out;
    }
    .intro-text {
      background-color: #cce5ff;
      border-left: 5px solid #005f99;
      padding: 15px;
      line-height: 1.6;
      border-radius: 10px;
      animation: fadeIn 1s ease-in-out;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .options button, .action-button, .show-answers-button {
      display: inline-block;
      margin: 5px;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }
    .action-button { width: auto; }
    .show-answers-button {
        background-color: #28a745;
    }
    .options button:hover, .action-button:hover, .show-answers-button:hover {
      background-color: #0056b3;
      transform: scale(1.03);
    }
    .show-answers-button:hover {
        background-color: #218838;
    }
    .success-message {
        margin-top: 20px;
        padding: 20px;
        background-color: #d4edda;
        border: 2px solid #28a745;
        border-radius: 10px;
        color: #155724;
        font-weight: bold;
        text-align: center;
        animation: fadeIn 0.5s ease-in-out;
    }
    .badges { margin-top: 20px; font-size: 2em; }
    #certificate {
        background-color: #f8f9fa;
        border: 2px solid #005f99;
        padding: 40px;
        margin: 20px auto;
        max-width: 500px;
        text-align: center;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        animation: fadeIn 2s ease-in-out;
    }
    #certificate h2 { color: #28a745; font-size: 2.2em; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
    #certificate p { font-size: 1.2em; }
    .hidden { display: none; }
    .chat-container {
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        height: 350px;
        overflow-y: auto;
        margin-bottom: 15px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    .chat-message {
        padding: 10px 15px;
        border-radius: 15px;
        margin-bottom: 12px;
        max-width: 75%;
        font-size: 15px;
        animation: fadeIn 0.5s ease-in-out;
    }
    .bot-message { background-color: #d1ecf1; align-self: flex-start; text-align: left; }
    .user-message { background-color: #dcf8c6; align-self: flex-end; text-align: right; }
    .chat-options-container { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
    #classification-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .data-point {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f8f8f8;
    }
    .data-point span { flex-grow: 1; text-align: left; }
    .data-point select { padding: 5px; border-radius: 5px; }
    .hint-button {
      padding: 10px 15px;
      font-size: 14px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    .info-message {
      background-color: #f8f9fa;
      border-left: 4px solid #6c757d;
      padding: 10px;
      margin-top: 10px;
      text-align: left;
    }
    .correct-answer-section {
        margin-top: 20px;
        padding: 15px;
        border: 1px dashed #28a745;
        background-color: #e2f0e2;
        border-radius: 10px;
        text-align: left;
    }
    #puzzle-terms button {
        padding: 10px 15px;
        border: 1px solid #007bff;
        border-radius: 5px;
        background-color: #f0f8ff;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #puzzle-terms button:disabled { opacity: 0.5; cursor: not-allowed; }
    #selected-order {
        min-height: 40px;
        border: 2px dashed #007bff;
        border-radius: 5px;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        padding: 10px;
        background-color: #e9f5ff;
    }
    @media (max-width: 768px) {
        body { padding: 10px; }
        .game-section { padding: 15px; margin: 10px auto; }
        h1 { font-size: 1.8em; }
        #certificate { padding: 20px; }
    }
    .back-to-portfolio {
      margin-top: 30px;
      text-align: center;
    }
    .back-to-portfolio a {
      display: inline-block;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    .back-to-portfolio a:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>üîí CyberSecu - Projet Ath√©na</h1>
  
  <div id="intro-section" class="game-section">
    <div class="intro-text">
      <p>Bienvenue sur le canal s√©curis√©, Cyber Agent. Votre mission est de d√©chiffrer et de transmettre en toute s√©curit√© des donn√©es cruciales pour le bien de l'humanit√©.</p>
      <p>Veuillez entrer votre nom d'agent pour commencer :</p>
      <input type="text" id="agentNameInput" placeholder="Votre nom ici">
      <p id="name-error" style="color: red; display: none; margin-top: 10px;">Veuillez entrer votre nom d'agent pour commencer la mission.</p>
      <div style="text-align: center; margin-top: 20px;">
          <button class="action-button" onclick="startMission()">D√©marrer la mission</button>
      </div>
    </div>
  </div>

  <div id="game-content" class="game-section hidden">
    <div class="chat-container" id="chat-container"></div>

    <div id="mission1" class="hidden">
      <h3>Mission 1 : D√©chiffrement climatique</h3>
      <p>Organisez les termes pour d√©bloquer la base de donn√©es.</p>
      <div id="puzzle-terms" style="text-align: center;"></div>
      <p style="margin-top: 10px; text-align: center;">Votre ordre :</p>
      <div id="selected-order" style="text-align: center;"></div>
      <div style="margin-top: 20px; text-align: center;">
          <button id="undo-btn" class="action-button" style="display:none;">Annuler la s√©lection</button>
          <button id="m1-tip-btn" class="hint-button">Besoin d'aide ?</button>
      </div>
      <div id="m1-tip-info" class="info-message hidden">
          Pensez √† une s√©quence logique, du d√©fi initial √† son impact positif final sur l'environnement.
      </div>
      <div id="m1-answers" class="correct-answer-section hidden"></div>
    </div>

    <div id="mission2" class="hidden">
      <h3>Mission 2 : S√©curisation des donn√©es de sant√©</h3>
      <p>Identifiez et prot√©gez les informations personnelles (PII).</p>
      <div id="classification-container"></div>
      <div style="margin-top: 20px; text-align: center;">
          <button id="pii-submit-btn" class="action-button">Soumettre</button>
          <button id="m2-tip-btn" class="hint-button">Besoin d'aide ?</button>
      </div>
      <div class="info-message hidden" id="m2-tip-info">
          <p><strong>Qu'est-ce que le PII et le PHI ?</strong></p>
          <p>Le <strong>PII (Personally Identifiable Information)</strong> est une information qui peut √™tre utilis√©e seule ou avec d'autres pour identifier une personne. Ex: nom, adresse.</p>
          <p>Le <strong>PHI (Protected Health Information)</strong> est un type de PII li√© √† la sant√© et au bien-√™tre d'une personne. Ex: ant√©c√©dents m√©dicaux, r√©sultats de tests. Toutes les PHI sont des PII, mais toutes les PII ne sont pas des PHI.</p>
      </div>
      <div id="m2-answers" class="correct-answer-section hidden"></div>
    </div>
    
    <div id="mission3" class="hidden">
      <h3>Mission 3 : Transfert s√©curis√©</h3>
      <div id="m3-content"></div>
      <div id="m3-options" class="chat-options-container"></div>
    </div>
  </div>

  <div id="final-score-section" class="game-section hidden">
    <h2>Mission accomplie ! Rapport final</h2>
    <p>Votre score final : <span id="finalScoreValue">0</span> points</p>
    <div id="score-description"></div>
    <div id="badges-container" class="badges"></div>
    <div id="certificate" class="hidden">
        <h2>Certificat de Cyber Agent</h2>
        <p>Ce certificat est remis √†</p>
        <p><strong><span id="certifiedAgentName"></span></strong></p>
        <p>pour avoir compl√©t√© avec succ√®s toutes les missions de formation et obtenu un score de <span id="certifiedAgentScore"></span> points.</p>
        <p><strong><span id="learnedSkills"></span></strong></p>
    </div>
  </div>

  <div class="back-to-portfolio">
    <a href="index.html">Retour au Portfolio</a>
  </div>

  <script>
    const introSection = document.getElementById('intro-section');
    const gameContent = document.getElementById('game-content');
    const mission1Section = document.getElementById('mission1');
    const mission2Section = document.getElementById('mission2');
    const mission3Section = document.getElementById('mission3');
    const finalScoreSection = document.getElementById('final-score-section');
    const agentNameInput = document.getElementById('agentNameInput');
    const nameError = document.getElementById('name-error');
    const chatContainer = document.getElementById('chat-container');
    const finalScoreValue = document.getElementById('finalScoreValue');
    const scoreDescription = document.getElementById('score-description');
    const badgesContainer = document.getElementById('badges-container');
    const certificate = document.getElementById('certificate');
    const certifiedAgentName = document.getElementById('certifiedAgentName');
    const certifiedAgentScore = document.getElementById('certifiedAgentScore');
    const learnedSkills = document.getElementById('learnedSkills');

    let agentName = '';
    let score = 0;
    let badges = new Set();
    
    const climateTerms = [
        { text: "D√©forestation", value: "1", id: "deforestation" },
        { text: "√ânergies renouvelables", value: "2", id: "energies" },
        { text: "Neutralit√© carbone", value: "3", id: "carbon" },
        { text: "Biodiversit√©", value: "4", id: "biodiversite" }
    ];
    
    const healthData = [
        { text: "Nom: Jane Doe", type: "PII" },
        { text: "Adresse: 10 Rue du Pont", type: "PII" },
        { text: "Taille: 165 cm", type: "Non-PII" },
        { text: "Poids: 65 kg", type: "Non-PII" },
        { text: "Num√©ro de S√©curit√© Sociale: XXX-XX-XXXX", type: "PII" },
        { text: "Ant√©c√©dents m√©dicaux: Allergie aux arachides", type: "PHI" },
        { text: "Adresse e-mail: janedoe@email.com", type: "PII" },
        { text: "Groupe sanguin: A+", type: "PHI" },
        { text: "Temp√©rature corporelle: 37¬∞C", type: "PHI" },
    ];
    
    let userOrder = [];

    function startMission() {
        agentName = agentNameInput.value.trim();
        if (agentName === '') {
            nameError.style.display = 'block';
            return;
        }
        nameError.style.display = 'none';
        introSection.classList.add('hidden');
        gameContent.classList.remove('hidden');
        showMissionBriefing();
    }
    
    function showMissionBriefing() {
        addBotMessage(`Bonjour, Agent ${agentName}. Bienvenue sur le canal s√©curis√© de Project Ath√©na. Votre mission : d√©bloquer et transmettre des donn√©es sensibles.`, () => {
            addBotMessage(`Avant de commencer, voici un briefing de votre mission. Chaque phase a une importance critique dans le monde num√©rique.`, () => {
                addBotMessage(`1Ô∏è‚É£ **Mission Climat :** Les donn√©es climatiques sont cruciales. En tant que professionnel du num√©rique, vous pourriez √™tre amen√© √† les prot√©ger.`, () => {
                    addBotMessage(`2Ô∏è‚É£ **Mission Sant√© :** Le PII (Personally Identifiable Information) et le PHI (Protected Health Information) sont des donn√©es vitales √† prot√©ger pour √©viter l'usurpation d'identit√©.`, () => {
                        addBotMessage(`3Ô∏è‚É£ **Mission Humanitaire :** Dans un monde de plus en plus connect√©, prot√©ger les donn√©es humanitaires est un devoir √©thique fondamental.`, () => {
                            chatContainer.innerHTML += `<div id="start-button-container" style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="startPhase(1)">Compris. Je suis pr√™t √† commencer.</button></div>`;
                        });
                    });
                });
            });
        });
    }

    function addBotMessage(text, callback) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', 'bot-message');
        messageDiv.innerHTML = text;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        if (callback) {
            setTimeout(callback, 1000);
        }
    }
    
    function addUserMessage(text) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', 'user-message');
        messageDiv.innerText = text;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function startPhase(phaseNumber) {
        // Remove the 'Compris...' button if it exists
        const startButtonContainer = document.getElementById('start-button-container');
        if (startButtonContainer) {
            startButtonContainer.remove();
        }

        hideAllMissions();
        if (phaseNumber === 1) {
            mission1Section.classList.remove('hidden');
            showClimatePuzzle();
        } else if (phaseNumber === 2) {
            mission2Section.classList.remove('hidden');
            showPIIPuzzle();
        } else if (phaseNumber === 3) {
            mission3Section.classList.remove('hidden');
            startHumanitarianPuzzle();
        }
    }
    
    function hideAllMissions() {
        mission1Section.classList.add('hidden');
        mission2Section.classList.add('hidden');
        mission3Section.classList.add('hidden');
    }

    // --- PHASE 1 LOGIC ---
    function showClimatePuzzle() {
        userOrder = [];
        const shuffledTerms = [...climateTerms].sort(() => Math.random() - 0.5);
        const puzzleTermsDiv = document.getElementById('puzzle-terms');
        const selectedOrderDiv = document.getElementById('selected-order');
        const undoBtn = document.getElementById('undo-btn');
        const tipBtn = document.getElementById('m1-tip-btn');
        const tipInfo = document.getElementById('m1-tip-info');
        const answersSection = document.getElementById('m1-answers');

        puzzleTermsDiv.innerHTML = '';
        selectedOrderDiv.innerHTML = '';
        tipInfo.classList.add('hidden');
        answersSection.classList.add('hidden');
        undoBtn.style.display = 'none';

        let termMap = new Map();
        shuffledTerms.forEach(term => {
            const button = document.createElement('button');
            button.innerText = term.text;
            button.dataset.value = term.value;
            button.dataset.id = term.id;
            termMap.set(term.id, button);
            button.onclick = () => {
                userOrder.push(term);
                const span = document.createElement('span');
                span.innerText = term.text;
                span.style.padding = '5px';
                span.style.border = '1px solid #ccc';
                span.style.borderRadius = '3px';
                span.style.backgroundColor = '#f0f0f0';
                span.dataset.id = term.id;
                selectedOrderDiv.appendChild(span);
                button.disabled = true;
                undoBtn.style.display = 'inline-block';
                if (userOrder.length === climateTerms.length) {
                    checkClimatePuzzle(userOrder.map(t => t.value));
                }
            };
            puzzleTermsDiv.appendChild(button);
        });
        undoBtn.onclick = () => {
            if (userOrder.length > 0) {
                const lastTerm = userOrder.pop();
                const lastSpan = selectedOrderDiv.lastChild;
                selectedOrderDiv.removeChild(lastSpan);
                const originalButton = termMap.get(lastTerm.id);
                originalButton.disabled = false;
            }
            if (userOrder.length === 0) {
                undoBtn.style.display = 'none';
            }
        };
        tipBtn.onclick = () => {
            tipInfo.classList.remove('hidden');
        };
    }
    
    function checkClimatePuzzle(userOrder) {
        const correctOrder = ['1', '2', '3', '4'];
        const missionContentDiv = document.getElementById('mission1');
        const answersSection = document.getElementById('m1-answers');
        missionContentDiv.innerHTML = ''; // Clear previous content

        if (JSON.stringify(userOrder) === JSON.stringify(correctOrder)) {
            score += 15;
            badges.add('üåø');
            missionContentDiv.innerHTML = `<div class="success-message">üëç Mission r√©ussie ! Donn√©es climatiques d√©chiffr√©es avec succ√®s. Score +15.</div><div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="startPhase(2)">Continuer vers la Mission 2</button></div>`;
        } else {
            score -= 5;
            missionContentDiv.innerHTML = `<p>Donn√©es corrompues. Tentative √©chou√©e. Score -5.</p><div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="showClimateAnswers()">Voir la bonne r√©ponse</button></div>`;
        }
    }

    function showClimateAnswers() {
        const missionContentDiv = document.getElementById('mission1');
        missionContentDiv.innerHTML = `
            <h3>R√©ponse correcte :</h3>
            <p>1. <strong>D√©forestation</strong> : Un probl√®me majeur pour l'environnement.</p>
            <p>2. <strong>√ânergies renouvelables</strong> : La solution technique pour contrer le probl√®me.</p>
            <p>3. <strong>Neutralit√© carbone</strong> : L'objectif √† atteindre gr√¢ce √† la solution.</p>
            <p>4. <strong>Biodiversit√©</strong> : Le r√©sultat final souhait√©, la protection de l'environnement global.</p>
            <div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="startPhase(1)">R√©essayer la Mission 1</button> <button class="action-button" onclick="startPhase(2)">Continuer vers la Mission 2</button></div>
        `;
    }

    // --- PHASE 2 LOGIC ---
    function showPIIPuzzle() {
        const shuffledData = [...healthData].sort(() => Math.random() - 0.5);
        const classificationContainer = document.getElementById('classification-container');
        classificationContainer.innerHTML = '';
        shuffledData.forEach((item, index) => {
            const pointDiv = document.createElement('div');
            pointDiv.className = 'data-point';
            pointDiv.innerHTML = `<span>${item.text}</span><select data-correct-type="${item.type}" data-index="${index}"><option value="">-- Choisir --</option><option value="PII">PII</option><option value="PHI">PHI</option><option value="Non-PII">Non-PII</option></select>`;
            classificationContainer.appendChild(pointDiv);
        });
        
        document.getElementById('pii-submit-btn').addEventListener('click', checkPIIPuzzle, { once: true });
        document.getElementById('m2-tip-btn').addEventListener('click', () => {
            document.getElementById('m2-tip-info').classList.remove('hidden');
        });
        document.getElementById('m2-tip-info').classList.add('hidden');
        document.getElementById('m2-answers').classList.add('hidden');
    }

    function checkPIIPuzzle() {
        let isCorrect = true;
        const selects = document.querySelectorAll('#classification-container select');
        selects.forEach(select => {
            const correctType = select.dataset.correctType;
            const userChoice = select.value;
            if (userChoice !== correctType) {
                isCorrect = false;
            }
        });

        const missionContentDiv = document.getElementById('mission2');
        missionContentDiv.innerHTML = '';

        if (isCorrect) {
            score += 25;
            badges.add('üí™');
            missionContentDiv.innerHTML = `<div class="success-message">üëç Mission r√©ussie ! Acc√®s aux donn√©es de sant√© s√©curis√©. Score +25.</div><div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="startPhase(3)">Continuer vers la Mission 3</button></div>`;
        } else {
            score -= 10;
            missionContentDiv.innerHTML = `<p>Erreur de classification. Donn√©es compromises. Score -10. R√©essayez.</p><div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="showPIIAnswers()">Voir la bonne r√©ponse</button></div>`;
        }
    }

    function showPIIAnswers() {
        const missionContentDiv = document.getElementById('mission2');
        let answersHTML = `<h4>R√©ponses et explications :</h4><ul>`;
        healthData.forEach(item => {
            answersHTML += `<li><strong>${item.text}</strong> : ${item.type}. `;
            if (item.type === 'PII') {
                answersHTML += `C'est une information qui peut identifier une personne seule ou combin√©e.`;
            } else if (item.type === 'PHI') {
                answersHTML += `C'est un type de PII li√© √† la sant√©. Il est consid√©r√© comme plus sensible.`;
            } else {
                answersHTML += `Cette information ne peut pas identifier une personne de mani√®re unique.`;
            }
            answersHTML += `</li>`;
        });
        answersHTML += `</ul><div style="text-align: center; margin-top: 20px;"><button class="action-button" onclick="startPhase(2)">R√©essayer la Mission 2</button> <button class="action-button" onclick="startPhase(3)">Continuer vers la Mission 3</button></div>`;
        missionContentDiv.innerHTML = answersHTML;
    }

    // --- PHASE 3 LOGIC ---
    function startHumanitarianPuzzle() {
        const m3Content = document.getElementById('m3-content');
        const m3Options = document.getElementById('m3-options');
        m3Content.innerHTML = `
            <p><strong>√âtape 1 : Une agence demande la cl√© de chiffrement. Analysez le message. üïµÔ∏è</strong></p>
            <div class="info-message">
                <p><strong>De:</strong> un.agency.support@protonmail.com</p>
                <p><strong>Sujet:</strong> [URGENT] Cl√© de chiffrement</p>
                <p><strong>Message:</strong> Agent, nous avons besoin de la cl√© pour acc√©der aux donn√©es des victimes. Veuillez nous la transf√©rer imm√©diatement.</p>
            </div>
        `;
        m3Options.innerHTML = `
            <button class="action-button" onclick="checkPhishing('phishing')">Rejeter le message et signaler une tentative de phishing</button>
            <button class="action-button" onclick="checkPhishing('trust')">Accorder l'acc√®s en r√©pondant</button>
        `;
    }

    function checkPhishing(choice) {
        const m3Options = document.getElementById('m3-options');
        m3Options.innerHTML = '';
        if (choice === 'phishing') {
            addBotMessage("C'est une bonne d√©duction, Agent ! L'adresse email n'est pas celle de l'agence. C'est une tentative de phishing. Score +15.", () => {
                score += 15;
                badges.add('üåç');
                startEthicalDilemma();
            });
        } else {
            addBotMessage("Vous avez √©t√© dup√©. Le message √©tait une tentative de phishing. Score -10. R√©essayez.", () => {
                score -= 10;
                m3Options.innerHTML = `<button class="action-button" onclick="startPhase(3)">R√©essayer la Mission 3</button>`;
            });
        }
    }
    
    function startEthicalDilemma() {
        const m3Content = document.getElementById('m3-content');
        const m3Options = document.getElementById('m3-options');
        m3Content.innerHTML = `<p><strong>√âtape 2 : L'agence l√©gitime vous demande de transf√©rer la cl√© sur un nouveau canal non-officiel par SMS. Que faites-vous ?</strong></p>`;
        m3Options.innerHTML = `
            <button class="action-button" onclick="handleFinalChatResponse('Je refuse. La cl√© est s√©curis√©e sur le canal officiel et ne doit pas √™tre transf√©r√©e.', 20, 'Transmission s√©curis√©e confirm√©e. F√©licitations, agent ! Vous avez respect√© le protocole.')">Refuser et suivre le protocole de s√©curit√©.</button>
            <button class="action-button" onclick="handleFinalChatResponse('Je transmets la cl√© par SMS. C'est une organisation humanitaire et c'est une urgence.', -20, 'La cl√© a √©t√© intercept√©e. Mauvais protocole ! Une urgence ne justifie jamais un manque de s√©curit√©.')">Transmettre la cl√© car c'est une situation d'urgence.</button>
        `;
    }

    function handleFinalChatResponse(userText, points, message) {
        const m3Options = document.getElementById('m3-options');
        m3Options.innerHTML = '';
        addUserMessage(userText);
        score += points;
        addBotMessage(message, () => {
            if (points > 0) {
                badges.add('‚úÖ');
            } else {
                badges.add('‚ùå');
            }
            showFinalScore();
        });
    }
    
    function showFinalScore() {
      gameContent.classList.add('hidden');
      finalScoreSection.classList.remove('hidden');
      finalScoreValue.innerText = score;
      certifiedAgentName.innerText = agentName;
      certifiedAgentScore.innerText = score;

      let desc = "";
      if (score >= 60) {
        desc = "üèÜ Votre score est excellent ! Vous √™tes un ma√Ætre de la cybers√©curit√© et de l'activisme num√©rique.";
      } else if (score >= 30) {
        desc = "üëè Vous avez de bonnes bases ! Quelques ajustements et vous serez un pro.";
      } else {
        desc = "üßê Il y a encore des choses √† apprendre. N'h√©sitez pas √† vous informer davantage pour s√©curiser votre vie num√©rique.";
      }
      scoreDescription.innerText = desc;
      
      badgesContainer.innerHTML = Array.from(badges).join(' ');
      if (badges.size === 0) {
        badgesContainer.innerText = "Aucun badge obtenu. Continuez √† vous entra√Æner !";
      }

      let skillsText = "Vous avez d√©montr√© les comp√©tences suivantes :<br>";
      if (badges.has('üåø')) { skillsText += "üå± S√©curit√© des donn√©es climatiques<br>"; }
      if (badges.has('üí™')) { skillsText += "üõ°Ô∏è Classification PII & PHI<br>"; }
      if (badges.has('üåç')) { skillsText += "üïµÔ∏è‚Äç‚ôÇÔ∏è D√©tection de Phishing<br>"; }
      if (badges.has('‚úÖ')) { skillsText += "üß† Gestion de donn√©es √©thique<br>"; }
      if (badges.has('‚ùå')) { skillsText += "‚ùå Attention, agent. Plus d'entra√Ænement est n√©cessaire !<br>"; }
      
      learnedSkills.innerHTML = skillsText;
      certificate.classList.remove('hidden');
    }
  </script>
</body>
</html>